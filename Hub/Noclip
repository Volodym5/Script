local Noclip = {}

local NoclipEnabled = false

game:GetService("RunService").Stepped:Connect(function()
    if NoclipEnabled then
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                for _, descendant in ipairs(game.Workspace:GetDescendants()) do
                    if descendant:IsA("BasePart") and descendant ~= rootPart then
                        descendant.CanCollide = false
                    end
                end
            end
        end
    end
end)

function Noclip.SetEnabled(enabled)
    NoclipEnabled = enabled
    if NoclipEnabled then
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Physics)
            end
        end
    else
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
            end
        end
    end
end

function Noclip.IsEnabled()
    return NoclipEnabled
end

return Noclip
